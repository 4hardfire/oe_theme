{#
/**
 * @file
 * Media container pattern.
 */
#}
{# Internal properties #}

{% set _css_class = 'ecl-media-container' %}
{% set _image = image|default('') %}
{% set _description = description|default('') %}
{% set _alt = alt|default('') %}
{% set _extra_attributes = '' %}
{% set _embedded_media = embedded_media|default('') %}
{% set _ratio = ratio|default('16-9') %}
{% set _sources = sources|default({}) %}
{% set _tracks = tracks|default({}) %}
{% set _compliance = compliance|default(false) %}

{# Internal logic - Process properties #}

{% if extra_classes is defined and extra_classes is not empty %}
  {% set _css_class = _css_class ~ ' ' ~ extra_classes %}
{% endif %}

{% if extra_attributes is defined and extra_attributes is not empty and extra_attributes is iterable %}
  {% for attr in extra_attributes %}
    {% if attr.value is defined %}
      {% set _extra_attributes = _extra_attributes ~ ' ' ~ attr.name ~ '="' ~ attr.value|e ~ '"' %}
    {% else %}
      {% set _extra_attributes = _extra_attributes ~ ' ' ~ attr.name %}
    {% endif %}
  {% endfor %}
{% endif %}

{% set _ratio = _ratio|replace({':': '-'}) %}
{% if _ratio not in ['16-9','4-3','3-2','1-1'] %}
  {% set _ratio = '16-9' %}
{% endif %}


{# Print the result #}
{% if title %}
  <h2 class="ecl-u-type-heading-2 ecl-u-mt-2xl ecl-u-mt-md-3xl ecl-u-mb-l">{{ title }}</h2>
{% endif %}
<figure class="{{ _css_class }}"{{ _extra_attributes|raw }}>
  {% if _embedded_media is not empty %}
    <div class="ecl-media-container__media ecl-media-container__media--ratio-{{ _ratio }}">
      {%- block embedded_media _embedded_media|raw -%}
    </div>
  {% elseif image or video or text %}
    <div class="ecl-row">
      {% if image or video%}
        <div class="ecl-col-md-6 ecl-u-order-md-last ecl-u-mb-m ecl-u-mb-md-none">
          {% if image %}
            {% include '@ecl-twig/media-container' with {
              'image': image.src,
              'alt': image.alt,
              'description': caption,
            } %}
          {% elseif video %}
            {% include '@ecl-twig/media-container' with {
              'embedded_media': video,
              'ratio': video_ratio,
              'description': caption,
            } %}
          {% endif %}
        </div>
      {% endif %}
      {% if text %}
        <div class="{{ image or video ? ' ecl-col-md-6' : 'ecl-col-12' }} ecl-editor">{{ text }}</div>
      {% endif %}
    </div>
  {% endif %}  
    
  {#{% elseif _sources is not empty and _sources is iterable %}#}
  {#  <video#}
  {#    class="ecl-media-container__media"#}
  {#    controls#}
  {#    poster="{{ _image }}"#}
  {#  >#}
  {#  {% for source in _sources %}#}
  {#    <source type="{{ source.type }}" src="{{ source.src }}" />#}
  {#  {% endfor %}#}
  {#  {% if _tracks is not empty and _tracks is iterable %}#}
  {#    {% for track in _tracks %}#}
  {#      <track#}
  {#        kind="{{ track.kind }}"#}
  {#        label="{{ track.label }}"#}
  {#        src="{{ track.src }}"#}
  {#        srclang="{{ track.src_lang }}"#}
  {#      />#}
  {#    {% endfor %}#}
  {#  {% endif %}#}
  {#  </video>#}
  {#{% else %}#}
  {#  <img#}
  {#    alt="{{ _alt }}"#}
  {#    class="ecl-media-container__media"#}
  {#    src="{{ _image }}"#}
  {#  />#}
  {#{% endif %}#}

  {% if _description is not empty %}
    <figcaption class="ecl-media-container__caption">
      {{- _description -}}
    </figcaption>
  {% endif %}
</figure>

{# Validation #}

{% if _compliance %}
  {% include '@ecl-twig/ec-component-ecl-compliance/components/ecl-compliance-media-container.html.twig' with {
    alt: _alt,
    image: _image,
    embedded_media: _embedded_media,
    sources: _sources,
    tracks: _tracks
  } only %}
{% endif %}
