<?php

/**
 * @file
 * Module file used for theming the News content type.
 */

declare(strict_types = 1);

use Drupal\Core\Cache\CacheableMetadata;
use Drupal\Core\TypedData\TranslatableInterface;
use Drupal\image\Entity\ImageStyle;
use Drupal\media\MediaInterface;

/**
 * Implements template_preprocess_node() for the News node type.
 */
function oe_theme_content_news_preprocess_node__oe_news(&$variables) {
  if ($variables['view_mode'] !== 'full') {
    return;
  }

  /** @var \Drupal\node\NodeInterface $node */
  $node = $variables['node'];

  $media = $node->get('oe_news_featured_media')->entity;
  if ($media instanceof MediaInterface) {
    $builder = \Drupal::entityTypeManager()->getViewBuilder('media');
    $variables['content']['featured_image'] = $builder->view($media, 'oe_theme_main_content');
    // Show the image always at the top.
    $variables['content']['featured_image']['#weight'] = -100;
    $variables['content']['featured_image']['#attributes']['class'][] = 'ecl-u-type-paragraph';
  }
}

/**
 * Implements hook_preprocess_HOOK() for node--oe-news--teaser.html.twig.
 */
function oe_theme_content_news_preprocess_node__oe_news__teaser(&$variables) {
  /** @var \Drupal\node\NodeInterface $node */
  $node = $variables['node'];
  // Use the short title if present, with fallback to the title.
  $variables['title'] = !$node->get('oe_content_short_title')->isEmpty() ? $node->get('oe_content_short_title')->value : $node->label();
}
